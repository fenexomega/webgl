<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=windows-1252">
<script id="vertex-shader" type="x-shader/x-vertex">
attribute vec4 vPosition;
attribute vec4 vNormal;
uniform vec3 uColor; 
uniform mat4 view,model,proj;

varying vec4 Color;
varying vec3 outNormal;
varying vec3 vertexPos;

mat4 transpose(mat4 inMatrix) {
	 vec4 i0 = inMatrix[0];
	 vec4 i1 = inMatrix[1];
	 vec4 i2 = inMatrix[2];
	 vec4 i3 = inMatrix[3];

	 mat4 outMatrix = mat4(
					 vec4(i0.x, i1.x, i2.x, i3.x),
					 vec4(i0.y, i1.y, i2.y, i3.y),
					 vec4(i0.z, i1.z, i2.z, i3.z),
					 vec4(i0.w, i1.w, i2.w, i3.w)
					 );
	return outMatrix;
}

void main()
{
	Color = vec4(uColor,1.0);
	//To transform the normals accordly to the model matrix
	outNormal = normalize(transpose((model))*vNormal).xyz;
	vertexPos = vec3(model * vec4(vPosition));
	gl_Position =  proj*view*model* vPosition;
}
</script>

<script id="fragment-shader" type="x-shader/x-fragment">
precision mediump float;

#define LIG_DIRECTION 	0
#define LIG_POINT 	  	1
#define LIG_SPOT 	  	2

uniform vec3 viewLocation;

varying vec4 Color;
varying vec3 outNormal;
varying vec3 vertexPos;

uniform struct Material
{
	vec3 ambient;
	vec3 difuse;
	vec3 specular;
	float shininess;
};

// TODO send light data to GPU
// do it in a way for having
// a variable amount of lights.
// declare an int for storing the
// currently amount of lights.
const int maxAmtOfLights = 8;
uniform int amtOfLights;

struct LightSource
{
	int type;
	float ambientStr;
	float specularStr;

	vec3 specular;
	vec3 position;
	vec3 color;
};

uniform LightSource Lights[maxAmtOfLights];

vec4 spotLight(LightSource light)
{
	//TODO
	return vec4(1.0);
}

vec4 pointLight(LightSource light)
{
	//TODO
	return vec4(1.0);
}

vec4 dirLight(LightSource light)
{
		
	vec3 ambient,diffuse,specular;

	//ambient calculation
	ambient = light.color * light.ambientStr;

	//diffuse calculation
	float diff = max(dot(outNormal,light.position),0.0);
	diffuse = light.color * diff;

	//specular
	vec3 viewDir = normalize(viewLocation - vertexPos);
	vec3 reflectedDir = reflect(-light.position,outNormal);
	//TODO change this 32 value to the material.shininess
	float spec = pow(max(dot(viewDir,reflectedDir),0.0),32.0);
	specular = light.specularStr * light.color * spec;

	return vec4(light.color,1.0);

	return vec4(ambient + diffuse + specular,1.0);
}

void main()
{
	vec4 result = Color;
	//workround for using variable loops
	//
	for(int i = 0; i < maxAmtOfLights; ++i)
	{
		if(i < amtOfLights)
		{
			if(Lights[i].type == LIG_DIRECTION)
			{
				result *= dirLight(Lights[i]);
			}
	//		case LIG_POINT:
	//			Color *= pointLight(Lights[i]); break;
	//		case LIG_SPOT:
	//			Color *= spotLight(lights[i]); break;
		}
		else
			break;
	}
    gl_FragColor = result;
}
</script>

<script type="text/javascript" src="webgl-utils.js"></script><style>[href^="http://www.amazon."][href*="tag="]
{display:none !important;}</style>
<script type="text/javascript" src="MV.js"></script>
<script type="text/javascript" src="initShaders.js"></script>
<script type="text/javascript" src="flatten.js"></script>
<script src="objects.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" src="assignment4.js"></script>
<script type="text/javascript" src="primitives.js"></script>
<script src="objects.js" type="text/javascript" charset="utf-8"></script>
<script src="lights.js" type="text/javascript" charset="utf-8"></script>



<link rel="stylesheet" href="../css/stylesheet.css">
<link rel="stylesheet" href="master.css">
</head>

<body >
<canvas id="gl-canvas" width="800" height="600">
Oops ... your browser doesn't support the HTML5 canvas element
</canvas>

<div id="tools">
	<div id="div_geoprops">
		Z-Distance (for the next object): <br>
		0
		<input type="range" value="0" min="0" max="15" step="1" onchange="changeDepth(value)" id="distance">
		15
		<div id="last_object" class="name">
			<b>Last Object Modifiers:</b>	
			<div id="div_transform">
				Rotation: <br>
				<b>x</b>: 0<input type="range" value="0" min="0" max="360" step="1" oninput="transformSelectedObject()" id="rotx">360<br>
				<b>y</b>: 0<input type="range" value="0" min="0" max="360" step="1" oninput="transformSelectedObject()" id="roty">360<br>
				<b>z</b>: 0<input type="range" value="0" min="0" max="360" step="1" oninput="transformSelectedObject()" id="rotz">360<br>
				Scale: <br>
				<input type="range" name="scale" id="scaletotal" value="1" max="10" min="0.1" step="0.1" oninput="transformSelectedObject()" />
			</div>
		</div>
		<div id="etc">
		
			<input id="html5colorpicker" class="form-control" onchange="changeColor(value)" value="#00ffff" type="color">
			Wireframe 
			<input type="checkbox" id="cbxWireframe" onclick="setWireframe(this)">
		</div>
	</div>

	<div id="div_geochoose">
		Figure: <br>

		<input type="radio" name="figure" onclick="selectFigure(figures.cube);">Cube</>
		<input type="radio" name="figure" onclick="selectFigure(figures.sphere);">Sphere</>
		<input type="radio" name="figure" onclick="selectFigure(figures.cylinder);">Cylinder</>
		<input type="radio" name="figure" onclick="selectFigure(figures.cone);">Cone</>
	</div>
		<button id="btnClear" onclick="clearObjects()"> Clear</button>
	</div>
	<div id="help_text">
		<p>
			To draw objects, click on the canvas on the left.
			
		</p>
	</div>
</div>
</body></html>
